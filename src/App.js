import "./App.css";
import { useState, useEffect } from "react";
import Web3 from "web3";
import ContractArtifact from "./HelloWorld.json";

function App() {
  const [msg, setMsg] = useState("");
  const [myAccount, setAccount] = useState("");

  const checkWallet = async () => {
    // Check if MetaMask is installed in the browser
    if (window.ethereum) {
      setMsg("Wallet Found");
    } else {
      setMsg("Please Install MetaMask");
    }
  };

  const readSmartContract = async () => {
    if (window.ethereum) {
      // If MetaMask found, request connection to the Wallet Accounts (log in)
      const account = await window.ethereum.request({
        method: "eth_requestAccounts",
      });

      // Select the last used account, store it in state variable
      setAccount(account[0]);

      // Web3.js
      // Select the ABI and contract address from Artifact file
      // const contractABI = ContractArtifact.abi;
      // const contractAddress = ContractArtifact.networks[5777].address;

      // Create a Web3 instance
      const web3 = new Web3(Web3.givenProvider);

      // Get the deployed contract as an object
      // const HelloContract = new web3.eth.Contract(contractABI, contractAddress);

      var foodregistryContract = new web3.eth.Contract([{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"serialNumber","type":"string"},{"indexed":false,"internalType":"string","name":"name","type":"string"}],"name":"FoodItemAdded","type":"event"},{"inputs":[{"internalType":"string","name":"name","type":"string"},{"internalType":"string","name":"serialNumber","type":"string"},{"internalType":"string","name":"productionDate","type":"string"},{"internalType":"string","name":"expiryDate","type":"string"},{"internalType":"string","name":"note","type":"string"}],"name":"addFoodItem","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getAllFoodItems","outputs":[{"internalType":"string[]","name":"","type":"string[]"},{"internalType":"string[]","name":"","type":"string[]"},{"internalType":"string[]","name":"","type":"string[]"},{"internalType":"string[]","name":"","type":"string[]"},{"internalType":"string[]","name":"","type":"string[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"serialNumber","type":"string"}],"name":"getFoodItem","outputs":[{"components":[{"internalType":"string","name":"name","type":"string"},{"internalType":"string","name":"productionDate","type":"string"},{"internalType":"string","name":"expiryDate","type":"string"},{"internalType":"string","name":"note","type":"string"}],"internalType":"struct FoodRegistry.FoodItem","name":"","type":"tuple"}],"stateMutability":"view","type":"function"}]);
      var foodregistry = foodregistryContract.deploy({
           data: '0x608060405234801561001057600080fd5b50611e90806100206000396000f3fe608060405234801561001057600080fd5b50600436106100415760003560e01c806387e6f416146100465780639694ebed14610062578063c8e98cd314610084575b600080fd5b610060600480360381019061005b91906111ff565b6100b4565b005b61006a6102fc565b60405161007b959493929190611447565b60405180910390f35b61009e600480360381019061009991906114bd565b61088f565b6040516100ab919061157e565b60405180910390f35b6001846040516100c491906115dc565b908152602001604051809103902060009054906101000a900460ff1615610120576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161011790611676565b60405180910390fd5b61012983610b7a565b610168576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161015f90611708565b60405180910390fd5b6101728383610b9b565b6101b1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101a89061179a565b60405180910390fd5b60006040518060800160405280878152602001858152602001848152602001838152509050806000866040516101e791906115dc565b9081526020016040518091039020600082015181600001908161020a91906119d0565b50602082015181600101908161022091906119d0565b50604082015181600201908161023691906119d0565b50606082015181600301908161024c91906119d0565b509050506001808660405161026191906115dc565b908152602001604051809103902060006101000a81548160ff0219169083151502179055506002859080600181540180825580915050600190039060005260206000200160009091909190915090816102ba91906119d0565b507f6dd1dfe36b1af1fa613a5bbee01aa26fd4fc1564f3eada70fdcc7b70c370f0d085876040516102ec929190611adb565b60405180910390a1505050505050565b6060806060806060600060028054905067ffffffffffffffff811115610325576103246110d4565b5b60405190808252806020026020018201604052801561035857816020015b60608152602001906001900390816103435790505b509050600060028054905067ffffffffffffffff81111561037c5761037b6110d4565b5b6040519080825280602002602001820160405280156103af57816020015b606081526020019060019003908161039a5790505b509050600060028054905067ffffffffffffffff8111156103d3576103d26110d4565b5b60405190808252806020026020018201604052801561040657816020015b60608152602001906001900390816103f15790505b509050600060028054905067ffffffffffffffff81111561042a576104296110d4565b5b60405190808252806020026020018201604052801561045d57816020015b60608152602001906001900390816104485790505b509050600060028054905067ffffffffffffffff811115610481576104806110d4565b5b6040519080825280602002602001820160405280156104b457816020015b606081526020019060019003908161049f5790505b50905060005b600280549050811015610873576000600282815481106104dd576104dc611b12565b5b9060005260206000200180546104f2906117e9565b80601f016020809104026020016040519081016040528092919081815260200182805461051e906117e9565b801561056b5780601f106105405761010080835404028352916020019161056b565b820191906000526020600020905b81548152906001019060200180831161054e57829003601f168201915b505050505090508087838151811061058657610585611b12565b5b6020026020010181905250600080826040516105a291906115dc565b908152602001604051809103902090508060000180546105c1906117e9565b80601f01602080910402602001604051908101604052809291908181526020018280546105ed906117e9565b801561063a5780601f1061060f5761010080835404028352916020019161063a565b820191906000526020600020905b81548152906001019060200180831161061d57829003601f168201915b505050505087848151811061065257610651611b12565b5b602002602001018190525080600101805461066c906117e9565b80601f0160208091040260200160405190810160405280929190818152602001828054610698906117e9565b80156106e55780601f106106ba576101008083540402835291602001916106e5565b820191906000526020600020905b8154815290600101906020018083116106c857829003601f168201915b50505050508684815181106106fd576106fc611b12565b5b6020026020010181905250806002018054610717906117e9565b80601f0160208091040260200160405190810160405280929190818152602001828054610743906117e9565b80156107905780601f1061076557610100808354040283529160200191610790565b820191906000526020600020905b81548152906001019060200180831161077357829003601f168201915b50505050508584815181106107a8576107a7611b12565b5b60200260200101819052508060030180546107c2906117e9565b80601f01602080910402602001604051908101604052809291908181526020018280546107ee906117e9565b801561083b5780601f106108105761010080835404028352916020019161083b565b820191906000526020600020905b81548152906001019060200180831161081e57829003601f168201915b505050505084848151811061085357610852611b12565b5b60200260200101819052505050808061086b90611b70565b9150506104ba565b5084848484849950995099509950995050505050509091929394565b61089761107d565b6001826040516108a791906115dc565b908152602001604051809103902060009054906101000a900460ff16610902576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108f990611c2a565b60405180910390fd5b60008260405161091291906115dc565b908152602001604051809103902060405180608001604052908160008201805461093b906117e9565b80601f0160208091040260200160405190810160405280929190818152602001828054610967906117e9565b80156109b45780601f10610989576101008083540402835291602001916109b4565b820191906000526020600020905b81548152906001019060200180831161099757829003601f168201915b505050505081526020016001820180546109cd906117e9565b80601f01602080910402602001604051908101604052809291908181526020018280546109f9906117e9565b8015610a465780601f10610a1b57610100808354040283529160200191610a46565b820191906000526020600020905b815481529060010190602001808311610a2957829003601f168201915b50505050508152602001600282018054610a5f906117e9565b80601f0160208091040260200160405190810160405280929190818152602001828054610a8b906117e9565b8015610ad85780601f10610aad57610100808354040283529160200191610ad8565b820191906000526020600020905b815481529060010190602001808311610abb57829003601f168201915b50505050508152602001600382018054610af1906117e9565b80601f0160208091040260200160405190810160405280929190818152602001828054610b1d906117e9565b8015610b6a5780601f10610b3f57610100808354040283529160200191610b6a565b820191906000526020600020905b815481529060010190602001808311610b4d57829003601f168201915b5050505050815250509050919050565b6000610b84610c1b565b805190602001208280519060200120149050919050565b600080600080610baa86610ce7565b9250925092506000806000610bbe88610ce7565b92509250925083811115610bdb5760019650505050505050610c15565b8381148015610bf65750600485610bf29190611c4a565b8210155b15610c0a5760019650505050505050610c15565b600096505050505050505b92915050565b606060008060008060004290506301e1855881610c389190611cad565b6107b2610c459190611c4a565b92506301e1855881610c579190611cde565b91506228207282610c689190611cad565b6001610c749190611c4a565b9350620151806228207283610c899190611cde565b610c939190611cad565b6001610c9f9190611c4a565b9450610caa85610ef5565b610cb385610ef5565b610cbc85610ef5565b604051602001610cce93929190611d5b565b6040516020818303038152906040529550505050505090565b600080600080849050603081600181518110610d0657610d05611b12565b5b602001015160f81c60f81b60f81c60ff16610d219190611da2565b600a603083600081518110610d3957610d38611b12565b5b602001015160f81c60f81b60f81c60ff16610d549190611da2565b610d5e9190611dd6565b610d689190611c4a565b9350603081600481518110610d8057610d7f611b12565b5b602001015160f81c60f81b60f81c60ff16610d9b9190611da2565b600a603083600381518110610db357610db2611b12565b5b602001015160f81c60f81b60f81c60ff16610dce9190611da2565b610dd89190611dd6565b610de29190611c4a565b9250603081600981518110610dfa57610df9611b12565b5b602001015160f81c60f81b60f81c60ff16610e159190611da2565b600a603083600881518110610e2d57610e2c611b12565b5b602001015160f81c60f81b60f81c60ff16610e489190611da2565b610e529190611dd6565b6064603084600781518110610e6a57610e69611b12565b5b602001015160f81c60f81b60f81c60ff16610e859190611da2565b610e8f9190611dd6565b6103e8603085600681518110610ea857610ea7611b12565b5b602001015160f81c60f81b60f81c60ff16610ec39190611da2565b610ecd9190611dd6565b610ed79190611c4a565b610ee19190611c4a565b610eeb9190611c4a565b9150509193909250565b606060008203610f3c576040518060400160405280600181526020017f30000000000000000000000000000000000000000000000000000000000000008152509050611078565b600082905060005b60008214610f6e578080610f5790611b70565b915050600a82610f679190611cad565b9150610f44565b60008167ffffffffffffffff811115610f8a57610f896110d4565b5b6040519080825280601f01601f191660200182016040528015610fbc5781602001600182028036833780820191505090505b50905060008290505b6000861461107057600181610fda9190611da2565b90506000600a8088610fec9190611cad565b610ff69190611dd6565b876110019190611da2565b603061100d9190611e25565b905060008160f81b90508084848151811061102b5761102a611b12565b5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350600a886110679190611cad565b97505050610fc5565b819450505050505b919050565b6040518060800160405280606081526020016060815260200160608152602001606081525090565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61110c826110c3565b810181811067ffffffffffffffff8211171561112b5761112a6110d4565b5b80604052505050565b600061113e6110a5565b905061114a8282611103565b919050565b600067ffffffffffffffff82111561116a576111696110d4565b5b611173826110c3565b9050602081019050919050565b82818337600083830152505050565b60006111a261119d8461114f565b611134565b9050828152602081018484840111156111be576111bd6110be565b5b6111c9848285611180565b509392505050565b600082601f8301126111e6576111e56110b9565b5b81356111f684826020860161118f565b91505092915050565b600080600080600060a0868803121561121b5761121a6110af565b5b600086013567ffffffffffffffff811115611239576112386110b4565b5b611245888289016111d1565b955050602086013567ffffffffffffffff811115611266576112656110b4565b5b611272888289016111d1565b945050604086013567ffffffffffffffff811115611293576112926110b4565b5b61129f888289016111d1565b935050606086013567ffffffffffffffff8111156112c0576112bf6110b4565b5b6112cc888289016111d1565b925050608086013567ffffffffffffffff8111156112ed576112ec6110b4565b5b6112f9888289016111d1565b9150509295509295909350565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600081519050919050565b600082825260208201905092915050565b60005b8381101561136c578082015181840152602081019050611351565b60008484015250505050565b600061138382611332565b61138d818561133d565b935061139d81856020860161134e565b6113a6816110c3565b840191505092915050565b60006113bd8383611378565b905092915050565b6000602082019050919050565b60006113dd82611306565b6113e78185611311565b9350836020820285016113f985611322565b8060005b85811015611435578484038952815161141685826113b1565b9450611421836113c5565b925060208a019950506001810190506113fd565b50829750879550505050505092915050565b600060a082019050818103600083015261146181886113d2565b9050818103602083015261147581876113d2565b9050818103604083015261148981866113d2565b9050818103606083015261149d81856113d2565b905081810360808301526114b181846113d2565b90509695505050505050565b6000602082840312156114d3576114d26110af565b5b600082013567ffffffffffffffff8111156114f1576114f06110b4565b5b6114fd848285016111d1565b91505092915050565b600060808301600083015184820360008601526115238282611378565b9150506020830151848203602086015261153d8282611378565b915050604083015184820360408601526115578282611378565b915050606083015184820360608601526115718282611378565b9150508091505092915050565b600060208201905081810360008301526115988184611506565b905092915050565b600081905092915050565b60006115b682611332565b6115c081856115a0565b93506115d081856020860161134e565b80840191505092915050565b60006115e882846115ab565b915081905092915050565b600082825260208201905092915050565b7f466f6f64206974656d207769746820746869732073657269616c206e756d626560008201527f7220616c72656164792065786973747300000000000000000000000000000000602082015250565b60006116606030836115f3565b915061166b82611604565b604082019050919050565b6000602082019050818103600083015261168f81611653565b9050919050565b7f50726f64756374696f6e2064617465206d75737420626520207468652063757260008201527f72656e7420646174650000000000000000000000000000000000000000000000602082015250565b60006116f26029836115f3565b91506116fd82611696565b604082019050919050565b60006020820190508181036000830152611721816116e5565b9050919050565b7f4578706972792064617465206d757374206265206174206c656173742034206d60008201527f6f6e7468732061667465722070726f64756374696f6e20646174650000000000602082015250565b6000611784603b836115f3565b915061178f82611728565b604082019050919050565b600060208201905081810360008301526117b381611777565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061180157607f821691505b602082108103611814576118136117ba565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b60006008830261187c7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8261183f565b611886868361183f565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b60006118cd6118c86118c38461189e565b6118a8565b61189e565b9050919050565b6000819050919050565b6118e7836118b2565b6118fb6118f3826118d4565b84845461184c565b825550505050565b600090565b611910611903565b61191b8184846118de565b505050565b5b8181101561193f57611934600082611908565b600181019050611921565b5050565b601f821115611984576119558161181a565b61195e8461182f565b8101602085101561196d578190505b6119816119798561182f565b830182611920565b50505b505050565b600082821c905092915050565b60006119a760001984600802611989565b1980831691505092915050565b60006119c08383611996565b9150826002028217905092915050565b6119d982611332565b67ffffffffffffffff8111156119f2576119f16110d4565b5b6119fc82546117e9565b611a07828285611943565b600060209050601f831160018114611a3a5760008415611a28578287015190505b611a3285826119b4565b865550611a9a565b601f198416611a488661181a565b60005b82811015611a7057848901518255600182019150602085019450602081019050611a4b565b86831015611a8d5784890151611a89601f891682611996565b8355505b6001600288020188555050505b505050505050565b6000611aad82611332565b611ab781856115f3565b9350611ac781856020860161134e565b611ad0816110c3565b840191505092915050565b60006040820190508181036000830152611af58185611aa2565b90508181036020830152611b098184611aa2565b90509392505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000611b7b8261189e565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8203611bad57611bac611b41565b5b600182019050919050565b7f466f6f64206974656d207769746820746869732073657269616c206e756d626560008201527f7220646f6573206e6f7420657869737400000000000000000000000000000000602082015250565b6000611c146030836115f3565b9150611c1f82611bb8565b604082019050919050565b60006020820190508181036000830152611c4381611c07565b9050919050565b6000611c558261189e565b9150611c608361189e565b9250828201905080821115611c7857611c77611b41565b5b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b6000611cb88261189e565b9150611cc38361189e565b925082611cd357611cd2611c7e565b5b828204905092915050565b6000611ce98261189e565b9150611cf48361189e565b925082611d0457611d03611c7e565b5b828206905092915050565b7f2d00000000000000000000000000000000000000000000000000000000000000600082015250565b6000611d456001836115a0565b9150611d5082611d0f565b600182019050919050565b6000611d6782866115ab565b9150611d7282611d38565b9150611d7e82856115ab565b9150611d8982611d38565b9150611d9582846115ab565b9150819050949350505050565b6000611dad8261189e565b9150611db88361189e565b9250828203905081811115611dd057611dcf611b41565b5b92915050565b6000611de18261189e565b9150611dec8361189e565b9250828202611dfa8161189e565b91508282048414831517611e1157611e10611b41565b5b5092915050565b600060ff82169050919050565b6000611e3082611e18565b9150611e3b83611e18565b9250828201905060ff811115611e5457611e53611b41565b5b9291505056fea2646970667358221220130d7f1f30723e7da9ec6d46a797c6e951b8450ce5610ed16c9b803e65ddfee164736f6c63430008120033', 
           arguments: [
           ]
      }).send({
           from: web3.eth.accounts[0], 
           gas: '4700000'
         }, function (e, contract){
          console.log(e, contract);
          if (typeof contract.address !== 'undefined') {
               console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
          }
       })



      // Send a transaction
      // try {
      //   await HelloContract.methods.setHello("Bye Bye Class").send({ from: account[0] });
      // } catch (error) {
      //   alert(error);
      // }


      

      // Return(call) the getHello function of the contract
      // const theResponse = await HelloContract.methods.getHello().call();
  
      // setMsg(theResponse);
    } else {
      // If no Wallet
      alert("Get MetaMask to connect");
    }
  };

  // Run checkWallet on Page Loading
  useEffect(() => {
    checkWallet();
  }, []);

  return (
    <div className="App">
      <p>
        {/* If the Wallet is connected to an Account returns the message. Else show connect button */}
        {myAccount ? (
          msg
        ) : (
          <button onClick={readSmartContract}> Connect </button>
        )}
      </p>
    </div>
  );
}

export default App;
